---
const {btn} = Astro.props;

let href = '#';

// External link
if (btn.link?.external) {
  href = btn.link.external + (btn.section ? `#${btn.section}` : '');
}
// Internal link
else if (btn.link?.internal?.slug?.current) {
  const slug = btn.link.internal.slug.current;
  const type = btn.link.internal._type;
  
  if (type === 'page') {
    href = `/pages/${slug}${btn.section ? `#${btn.section}` : ''}`;
  } else if (type === 'case') {
    href = `/cases/${slug}${btn.section ? `#${btn.section}` : ''}`;
  } else {
    // fallback to top-level
    href = `/${slug}${btn.section ? `#${btn.section}` : ''}`;
  }
}
// Anchor only
else if (btn.section) {
  href = `#${btn.section}`;
}

const className = 'navlink';
const activeClass = 'underline';
const finalHref = href ?? (btn.link?.internal?.slug ? `/pages/${btn.link?.internal?.slug}` : '#');
const currentPath = Astro.url.pathname;
const isActive = finalHref === currentPath;

const finalClass = `${className} ${isActive ? activeClass : ''}`.trim();

---

<li>
  <a
    href={finalHref}
    target={btn.newTab ? '_blank' : '_self'}
    rel={btn.newTab ? 'noopener noreferrer' : undefined}
    class={finalClass}
  >
    {btn.title}
  </a>
</li>
